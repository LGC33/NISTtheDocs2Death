# This is a basic workflow that is manually triggered

name: NISTtheDocs2Death
description: Deploys Sphinx-built documentation to https://pages.nist.gov
author: Jonathan Guyer

inputs:
  docs-folder:
    description:
      The folder containing your sphinx docs.
    required: true
    default: "docs/"
  pages-branch:
    description: 
      The branch linked to your documentation server.
    default: 'nist-pages'
  pages-url:
    description:
      URL of web server for served documentation.
    default: 'https://pages.nist.gov'
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - uses: usnistgov/sphinx-action@master
      name: Build HTML
      with:
        docs-folder: ${{ inputs.docs-folder }}
#       - uses: usnistgov/sphinx-action@master
#         name: Build ePUB
#         with:
#           docs-folder: ${{ inputs.docs-folder }}
#           build-command: make epub
#       - uses: usnistgov/sphinx-action@latexpdf
#         name: Build PDF
#         with:
#           docs-folder: ${{ inputs.docs-folder }}
    - name: Commit documentation changes
      uses: docker://Dockerfile
      with:
        entrypoint:  # command executable that need to be run in a container
        args: |
          ${{ inputs.docs-folder }} |
          ${{ github.event.repository.default_branch }} |
          ${{ inputs.pages-branch }} |
          ${{ inputs.pages-url }}
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        branch: ${{ inputs.pages-branch }}
        directory: __nist-pages
        github_token: ${{ github.token }}
    - uses: actions/upload-artifact@v3
      name: Upload Documentation Artifacts
      with:
        name: ${{ github.event.repository.name }}-${{ github.ref_name }}-${{ github.sha }}
        path: |
          docs/_build/html
#             docs/_build/epub/*.epub
#             docs/_build/latex/${{ github.event.repository.name }}.pdf
      # Use always() to always run this step to publish documentation
      # artifacts even when there are failures
      if: ${{ always() }}
